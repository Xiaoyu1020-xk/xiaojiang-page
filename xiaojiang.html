<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>小江姐姐专属页面</title>
    <style>
        /* 基础重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            height: 100%;
            background: #000;
            overflow: hidden;
            font-family: "Comic Sans MS", "微软雅黑", cursive;
        }

        /* 1. 音乐播放提示层 */
        .music-tip {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            cursor: pointer;
        }
        .tip-content {
            font-size: 18px;
            color: #ffeff8;
            padding: 12px 24px;
            background: rgba(255,105,180,0.4);
            border-radius: 30px;
            max-width: 80%;
        }
        .music-tip.hide {
            display: none;
        }

        /* 2. 主爱心容器 */
        .heart-container {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 280px;
            height: 280px;
            z-index: 1;
        }
        .heart-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* 3. 歌词容器 */
        .lyrics-container {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 160px;
            height: 320px;
            overflow: hidden;
            z-index: 2;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 8px 0;
        }
        .lyrics-scroll {
            position: relative;
            transition: transform 0.5s ease;
        }
        .lyrics-line {
            height: 32px;
            line-height: 32px;
            text-align: center;
            font-size: 14px;
            color: #ffcce5;
            margin: 6px 0;
            transition: all 0.3s ease;
        }
        .lyrics-line.highlight {
            color: #ff69b4;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 0 0 6px #ff69b4;
        }

        /* 4. 雪花特效 */
        .snowflake {
            position: absolute;
            color: #fff;
            opacity: 0.8;
            user-select: none;
            z-index: 0;
            animation: snowfall linear infinite;
        }
        @keyframes snowfall {
            0% { transform: translateY(-20px) rotate(0deg) scale(0.5); opacity: 0; }
            20% { opacity: 0.8; transform: translateY(20vh) rotate(120deg) scale(0.9); }
            80% { opacity: 0.8; transform: translateY(80vh) rotate(240deg) scale(0.9); }
            100% { transform: translateY(100vh) rotate(360deg) scale(0.9); opacity: 0; }
        }

        /* 5. 文本弹窗容器 */
        .popup-container {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 3;
            pointer-events: none;
            width: 90vw;
            max-width: 500px;
            height: 90vw;
            max-height: 500px;
        }
        .popup-card {
            background: linear-gradient(135deg, #ffeff8 0%, #ffe0f2 100%);
            padding: 6px 12px;
            border-radius: 18px;
            box-shadow: 0 2px 8px rgba(255, 105, 180, 0.4);
            font-size: 13px;
            color: #d63384;
            text-align: center;
            transition: all 0.4s ease;
            opacity: 0;
            transform: scale(0.7) translateY(8px);
            position: absolute;
            width: max-content;
            max-width: 120px;
        }
        .popup-card::before {
            content: "";
            position: absolute;
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 5px solid #ffeff8;
        }
        .popup-card.show {
            opacity: 1;
            transform: scale(1) translateY(0);
        }

        /* 6. 弹窗关闭按钮 */
        .popup-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            border: none;
            background: linear-gradient(135deg, #ffeff8 0%, #ffe0f2 100%);
            border-radius: 50%;
            font-size: 20px;
            color: #d63384;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(255, 105, 180, 0.3);
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        /* 7. 背景音乐控件 */
        audio {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 4;
            width: 85%;
            filter: hue-rotate(270deg) saturate(1.2);
            border-radius: 8px;
            height: 40px;
        }

        /* 电脑端适配 */
        @media (min-width: 768px) {
            .heart-container {
                width: 400px;
                height: 400px;
            }
            .lyrics-container {
                width: 220px;
                height: 450px;
                right: 20px;
            }
            .lyrics-line {
                height: 36px;
                line-height: 36px;
                font-size: 15px;
                margin: 8px 0;
            }
            .lyrics-line.highlight {
                font-size: 17px;
                text-shadow: 0 0 8px #ff69b4;
            }
            .popup-container {
                width: 600px;
                height: 600px;
            }
            .popup-card {
                padding: 8px 14px;
                font-size: 14px;
                max-width: 150px;
            }
            .popup-card::before {
                top: -5px;
                border-left: 6px solid transparent;
                border-right: 6px solid transparent;
                border-bottom: 6px solid #ffeff8;
            }
            .popup-close {
                width: 35px;
                height: 35px;
                top: 20px;
                right: 20px;
            }
            audio {
                width: auto;
                bottom: 15px;
                height: auto;
            }
            .tip-content {
                font-size: 20px;
                padding: 15px 30px;
            }
        }
    </style>
</head>
<body>
    <!-- 1. 音乐播放提示层 -->
    <div class="music-tip" id="musicTip">
        <div class="tip-content">点击任意位置播放音乐</div>
    </div>

    <!-- 2. 主爱心动画 -->
    <div class="heart-container">
        <img class="heart-img" src="https://pic.imgdb.cn/item/642547f5a682492fcc15cd5d.gif" alt="跳动爱心">
    </div>

    <!-- 3. 歌词容器 -->
    <div class="lyrics-container" id="lyricsContainer">
        <div class="lyrics-scroll" id="lyricsScroll"></div>
    </div>

    <!-- 4. 背景音乐 -->
    <audio loop preload="auto" id="audio" controls>
        <source src="背景音乐.mp3" type="audio/mpeg">
        您的浏览器不支持音频播放，请更新浏览器
    </audio>

    <!-- 5. 弹窗关闭按钮 -->
    <button class="popup-close" id="popupClose">×</button>

    <!-- 6. 弹窗容器 -->
    <div class="popup-container" id="popupContainer"></div>

    <script>
        // 1. 雪花生成
        function createSnowflakes() {
            const isMobile = window.innerWidth < 768;
            const snowCount = isMobile ? 180 : 300; // 移动端减少数量避免卡顿
            const body = document.body;
            for (let i = 0; i < snowCount; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.textContent = '❄';
                const left = Math.random() * 100 + 'vw';
                const size = isMobile ? (Math.random() * 10 + 8 + 'px') : (Math.random() * 15 + 12 + 'px');
                const duration = isMobile ? (Math.random() * 35 + 20 + 's') : (Math.random() * 35 + 15 + 's');
                const delay = Math.random() * 25 + 's';

                snowflake.style.left = left;
                snowflake.style.fontSize = size;
                snowflake.style.animationDuration = duration;
                snowflake.style.animationDelay = delay;

                body.appendChild(snowflake);
            }
        }

        // 2. 歌词加载与滚动（0.4倍速循环，内容保持不变）
        async function loadLyrics() {
            const lyricsScroll = document.getElementById('lyricsScroll');
            try {
                const response = await fetch('lyrics.txt');
                const text = await response.text();
                const lyricsLines = text.split('\n').filter(line => line.trim() !== '');
                
                // 生成歌词DOM
                lyricsLines.forEach(line => {
                    const div = document.createElement('div');
                    div.className = 'lyrics-line';
                    div.textContent = line.trim();
                    lyricsScroll.appendChild(div);
                });

                // 歌词滚动核心参数
                const lyricsContainer = document.getElementById('lyricsContainer');
                const containerHeight = lyricsContainer.clientHeight;
                const lineHeight = window.innerWidth < 768 ? 44 : 52; // 移动端行高适配
                const highlightIndex = Math.floor(containerHeight / (2 * lineHeight));
                let scrollTop = 0;
                const totalLines = lyricsLines.length;
                const scrollSpeed = 0.3;
                const scrollEnd = (totalLines - highlightIndex) * lineHeight;

                // 循环滚动函数
                function scrollLyrics() {
                    if (scrollTop >= scrollEnd) scrollTop = 0; // 滚动到尾重置
                    lyricsScroll.style.transform = `translateY(-${scrollTop}px)`;
                    
                    // 中间行高亮
                    document.querySelectorAll('.lyrics-line').forEach(div => {
                        div.classList.remove('highlight');
                    });
                    const currentLine = Math.floor(scrollTop / lineHeight) + highlightIndex;
                    if (currentLine < totalLines) {
                        document.querySelectorAll('.lyrics-line')[currentLine].classList.add('highlight');
                    }

                    scrollTop += scrollSpeed;
                    requestAnimationFrame(scrollLyrics);
                }
                scrollLyrics();

            } catch (error) {
                console.error('歌词加载失败：', error);
                lyricsScroll.innerHTML = '<div class="lyrics-line highlight">歌词加载失败，请检查文件</div>';
            }
        }

        // 3. 文本弹窗逻辑（弹窗文本已替换为你提供的内容）
        function initPopup() {
            // 替换后的弹窗文本列表
            const popupTexts = [
                "小江姐姐要开心哦",
                "小江姐姐对不起",
                "小江皇上对不起",
                "脆皮五花肉公主姐姐对不起",
                "老公我知道错了",
                "呜呜呜",
                "老公你原谅我好不好嘛",
                "求求老公了",
                "天冷了穿厚一点姐姐",
                "记得按时吃饭哦",
                "你睫毛上的雪花真美",
                "我是说小江姐姐真美",
                "姐姐不要生气了好不好",
                "我是姐姐的银渐层",
                "小江姐姐打王者最厉害啦",
                "小江姐姐要好好的",
                "最喜欢小江姐姐啦",
                "小江姐姐不要不理我",
                "小江姐姐冬日快乐",
                "好想和小江姐姐一起看雪啊",
                "小江姐姐是最棒的",
                "我来当姐姐的开心果"
            ];

            const popupContainer = document.getElementById('popupContainer');
            const containerSize = popupContainer.offsetWidth;
            const heartSize = window.innerWidth < 768 ? 280 : 400;
            const minDistance = heartSize / 2; // 避免弹窗遮挡爱心

            // 生成安全弹窗位置
            function getSafePosition() {
                const angle = Math.random() * Math.PI * 2;
                const distance = minDistance + Math.random() * (containerSize / 2 - minDistance);
                const x = Math.cos(angle) * distance;
                const y = Math.sin(angle) * distance;
                return { x, y };
            }

            // 创建单个弹窗
            function createPopup() {
                const randomText = popupTexts[Math.floor(Math.random() * popupTexts.length)];
                const { x, y } = getSafePosition();
                const card = document.createElement('div');
                card.className = 'popup-card';
                card.textContent = randomText;
                card.style.left = `calc(50% + ${x}px - ${card.offsetWidth / 2}px)`;
                card.style.top = `calc(50% + ${y}px - ${card.offsetHeight / 2}px)`;

                popupContainer.appendChild(card);
                setTimeout(() => card.classList.add('show'), 50); // 弹出动画
                // 自动消失
                setTimeout(() => {
                    card.style.opacity = 0;
                    card.style.transform = 'scale(0.8) translateY(8px)';
                    setTimeout(() => card.remove(), 400);
                }, Math.random() * 2000 + 3000);
            }

            // 持续生成弹窗
            const intervalTime = window.innerWidth < 768 ? (Math.random() * 1200 + 1200) : (Math.random() * 1000 + 1000);
            setInterval(createPopup, intervalTime);
            // 初始生成3个弹窗
            for (let i = 0; i < 3; i++) {
                setTimeout(createPopup, i * 500);
            }

            // 关闭按钮清空弹窗
            document.getElementById('popupClose').addEventListener('click', () => {
                popupContainer.innerHTML = '';
            });
        }

        // 页面初始化
        window.onload = function() {
            // 音乐播放逻辑
            const audio = document.getElementById('audio');
            const musicTip = document.getElementById('musicTip');
            function playMusicOnClick() {
                audio.play().catch(error => console.log('音乐播放需要用户交互：', error));
                musicTip.classList.add('hide');
                document.removeEventListener('click', playMusicOnClick);
            }
            document.addEventListener('click', playMusicOnClick);
            musicTip.addEventListener('click', playMusicOnClick);

            // 初始化核心功能
            createSnowflakes();
            loadLyrics(); // 歌词部分保持原有逻辑，内容从lyrics.txt读取
            setTimeout(initPopup, 1000);
        };
    </script>
</body>
</html>